<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Traductor n8n</title>
  <style>
  :root{
    --bg1:#ff1493; --bg2:#9d00ff;
    --cardA: rgba(255,255,0,.15);
    --cardB: rgba(255,105,180,.10);
    --stroke: rgba(255,255,0,.35);
    --stroke2: rgba(0,255,255,.25);

    --text:#fff;
    --muted: rgba(255,255,255,.85);

    --accent:#00ff00;
    --accent2:#ff00ff;

    --danger:#ff1493;

    --shadow: 0 28px 90px rgba(255,0,255,.55);
    --shadow2: 0 14px 35px rgba(0,255,255,.40);

    --radius: 25px;
    --radius2: 20px;
  }

  *{ box-sizing:border-box; }
  html,body{ height:100%; }

  body{
    margin:0;
    font-family: 'Comic Sans MS', 'Comic Sans', cursive, ui-sans-serif,system-ui;
    color:var(--text);
    min-height:100vh;
    background:
      repeating-linear-gradient(45deg, #ff1493 0px, #ff1493 10px, #9d00ff 10px, #9d00ff 20px),
      radial-gradient(1200px 600px at 12% 20%, rgba(255,255,0,.45), transparent 60%),
      radial-gradient(900px 500px at 85% 22%, rgba(0,255,255,.35), transparent 55%),
      radial-gradient(1000px 600px at 40% 95%, rgba(255,0,255,.25), transparent 60%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    padding: 28px 18px 48px;
    display:flex;
    align-items:center;
    justify-content:center;
    animation: backgroundShift 15s ease infinite;
  }

  @keyframes backgroundShift {
    0%, 100% { filter: hue-rotate(0deg) brightness(1); }
    50% { filter: hue-rotate(20deg) brightness(1.1); }
  }

  /* contenedor m√°s ‚Äúaireado‚Äù */
  .wrap{ width:min(1020px, 100%); }

  .top{
    display:flex;
    align-items:flex-end;
    justify-content:space-between;
    gap:14px;
    margin-bottom: 16px;
  }

  .brand{ display:flex; gap:12px; align-items:center; }

  .logo{
    width:46px; height:46px;
    border-radius: 16px;
    background: linear-gradient(135deg, #ff00ff, #00ff00, #ffff00, #00ffff);
    box-shadow: 0 14px 38px rgba(255,0,255,.60), 0 0 25px rgba(0,255,0,.50);
    position: relative;
    overflow:hidden;
    animation: logoSpin 3s linear infinite, logoPulse 1.5s ease-in-out infinite;
  }
  .logo:after{
    content:"üî•";
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    animation: emojiRotate 2s ease-in-out infinite;
  }

  @keyframes logoSpin {
    from { background-position: 0% 50%; }
    to { background-position: 100% 50%; }
  }
  @keyframes logoPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.08); }
  }
  @keyframes emojiRotate {
    0%, 100% { transform: rotate(-10deg); }
    50% { transform: rotate(10deg); }
  }

  h1{
    margin:0;
    font-size: 28px;
    letter-spacing:1px;
    line-height:1.05;
    font-weight: 900;
    text-transform: uppercase;
    background: linear-gradient(90deg, #ff00ff, #00ff00, #ffff00, #00ffff, #ff00ff);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: textShine 3s linear infinite;
    text-shadow: 0 0 20px rgba(255,0,255,.5);
  }

  @keyframes textShine {
    to { background-position: 200% center; }
  }
  .sub{
    margin:6px 0 0;
    color: var(--muted);
    font-size: 13.5px;
    line-height:1.35;
  }

  .pill{
    padding: 10px 12px;
    border-radius: 999px;
    background: linear-gradient(90deg, #ff00ff, #00ff00);
    border: 3px solid #ffff00;
    color: #000;
    font-size: 12px;
    font-weight: 900;
    display:flex;
    gap:8px;
    align-items:center;
    box-shadow: 0 0 20px rgba(255,0,255,.8), var(--shadow2);
    backdrop-filter: blur(10px);
    white-space: nowrap;
    animation: pillBounce 2s ease-in-out infinite;
  }
  .dot{
    width:8px; height:8px; border-radius:50%;
    background: #ffff00;
    box-shadow: 0 0 0 6px rgba(255,255,0,.40), 0 0 15px #ffff00;
    animation: dotPulse 1s ease-in-out infinite;
  }

  @keyframes pillBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
  }
  @keyframes dotPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.3); }
  }

  /* Card con borde y brillo sutil */
  .card{
    background: linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.85));
    border: 4px solid transparent;
    border-radius: calc(var(--radius) + 2px);
    box-shadow: var(--shadow), 0 0 40px rgba(255,0,255,.6), inset 0 0 30px rgba(255,255,0,.15);
    overflow:hidden;
    backdrop-filter: blur(14px);
    position: relative;
    background-image: linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.85)),
                      linear-gradient(90deg, #ff00ff, #00ff00, #ffff00, #00ffff, #ff00ff);
    background-origin: border-box;
    background-clip: padding-box, border-box;
  }
  .card:before{
    content:"";
    position:absolute;
    inset:0;
    pointer-events:none;
    background: 
      radial-gradient(circle at 20% 30%, rgba(255,0,255,.25), transparent 50%),
      radial-gradient(circle at 80% 70%, rgba(0,255,255,.25), transparent 50%);
    animation: cardGlow 4s ease-in-out infinite;
  }

  @keyframes cardGlow {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
  }

  .toolbar{
    padding: 16px 16px 6px;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
    justify-content:space-between;
    position: relative;
  }

  .controls{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
  }
  label{
    font-size: 12px;
    color: rgba(244,246,255,.72);
    margin-right: 2px;
  }

  select{
    padding: 10px 12px;
    border-radius: 12px;
    border: 3px solid #ff00ff;
    background: linear-gradient(135deg, rgba(0,0,0,.85), rgba(20,0,30,.90));
    color: #fff;
    outline: none;
    min-width: 190px;
    box-shadow: 0 0 15px rgba(255,0,255,.50), inset 0 1px 0 rgba(255,255,255,.10);
    transition: border-color .15s ease, transform .05s ease;
    font-weight: 700;
  }
  select:focus{
    border-color: #00ff00;
    box-shadow: 0 0 20px rgba(0,255,0,.60), inset 0 1px 0 rgba(255,255,255,.10);
    transform: scale(1.02);
  }

  .btn{
    border: 3px solid #000;
    padding: 10px 14px;
    border-radius: 15px;
    font-weight: 900;
    letter-spacing:1px;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    gap:10px;
    color: #000;
    background: linear-gradient(135deg, #ffff00, #00ff00);
    box-shadow: 0 8px 0 #ff00ff, 0 14px 34px rgba(255,0,255,.50);
    transition: transform .08s ease, filter .15s ease, box-shadow .15s ease;
    user-select:none;
    text-transform: uppercase;
    position: relative;
    transform: translateY(0);
  }
  .btn:hover{ 
    filter: brightness(1.1); 
    transform: translateY(-2px);
    box-shadow: 0 10px 0 #ff00ff, 0 18px 38px rgba(255,0,255,.60);
  }
  .btn:active{ 
    transform: translateY(4px);
    box-shadow: 0 4px 0 #ff00ff, 0 8px 20px rgba(255,0,255,.40);
  }
  .btn:disabled{ opacity:.6; cursor:not-allowed; }

  .btn.secondary{
    background: linear-gradient(135deg, #00ffff, #ff00ff);
    color: #000;
    border: 3px solid #000;
    box-shadow: 0 6px 0 #ffff00, 0 10px 25px rgba(255,255,0,.40);
  }
  .btn.secondary:hover{
    transform: translateY(-2px);
    box-shadow: 0 8px 0 #ffff00, 0 14px 30px rgba(255,255,0,.50);
  }
  .btn.secondary:active{
    transform: translateY(3px);
    box-shadow: 0 3px 0 #ffff00, 0 6px 15px rgba(255,255,0,.30);
  }

  .btn.ghost{
    background: linear-gradient(135deg, rgba(255,0,255,.3), rgba(0,255,255,.3));
    color: #fff;
    border: 3px solid #00ff00;
    box-shadow: 0 0 20px rgba(0,255,0,.50), 0 5px 0 #00ff00;
  }
  .btn.ghost:hover{
    transform: translateY(-2px);
    box-shadow: 0 0 25px rgba(0,255,0,.60), 0 7px 0 #00ff00;
  }
  .btn.ghost:active{
    transform: translateY(2px);
    box-shadow: 0 0 15px rgba(0,255,0,.40), 0 3px 0 #00ff00;
  }

  /* WhatsApp */
  .btn.whatsapp{
    background: linear-gradient(135deg, #25D366, #1ebe5d);
    color: #000;
    border: 3px solid #000;
    box-shadow: 0 7px 0 #128C7E, 0 14px 30px rgba(37,211,102,.40);
    font-weight: 900;
  }
  .btn.whatsapp:hover{
    transform: translateY(-2px);
    box-shadow: 0 9px 0 #128C7E, 0 18px 35px rgba(37,211,102,.50);
  }
  .btn.whatsapp:active{
    transform: translateY(3px);
    box-shadow: 0 4px 0 #128C7E, 0 8px 20px rgba(37,211,102,.30);
  }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    padding: 14px 16px 16px;
    position: relative;
  }

  @media (max-width: 860px){
    body{ padding: 18px 12px 34px; }
    .top{ align-items:flex-start; flex-direction:column; }
    .pill{ align-self:flex-start; }
    .grid{ grid-template-columns: 1fr; }
    select{ min-width: 170px; }
  }

  .panel{
    background: linear-gradient(135deg, rgba(0,0,0,.80), rgba(20,0,30,.85));
    border: 3px solid #00ffff;
    border-radius: var(--radius);
    padding: 12px;
    min-height: 240px;
    display:flex;
    flex-direction:column;
    gap: 10px;
    box-shadow: 0 0 20px rgba(0,255,255,.50), inset 0 2px 10px rgba(255,0,255,.15);
  }

  .panel h2{
    margin:0;
    font-size: 14px;
    color: #ffff00;
    font-weight: 900;
    letter-spacing:1px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    text-transform: uppercase;
    text-shadow: 0 0 10px rgba(255,255,0,.70), 0 2px 4px #000;
  }
  .small{
    font-size: 11px;
    color: #00ffff;
    font-weight: 700;
    text-shadow: 0 0 8px rgba(0,255,255,.60);
  }

  textarea{
    width:100%;
    flex: 1;
    resize: vertical;
    min-height: 160px;
    padding: 12px 12px;
    border-radius: var(--radius);
    border: 3px solid #ff00ff;
    background: rgba(0,0,0,.90);
    color: #fff;
    outline:none;
    line-height:1.45;
    box-shadow: 0 0 15px rgba(255,0,255,.45), inset 0 2px 8px rgba(255,0,255,.20);
    transition: border-color .15s ease, box-shadow .15s ease;
    font-weight: 600;
  }
  textarea:focus{
    border-color: #ffff00;
    box-shadow: 0 0 25px rgba(255,255,0,.60), inset 0 2px 8px rgba(255,255,0,.20);
  }

  .out{
    flex:1;
    padding: 12px;
    border-radius: var(--radius);
    border: 3px dashed #00ff00;
    background: rgba(0,0,0,.90);
    white-space: pre-wrap;
    overflow:auto;
    min-height: 160px;
    box-shadow: 0 0 15px rgba(0,255,0,.45), inset 0 2px 8px rgba(0,255,0,.15);
    animation: borderGlow 2s ease-in-out infinite;
  }

  @keyframes borderGlow {
    0%, 100% { border-color: #00ff00; box-shadow: 0 0 15px rgba(0,255,0,.45), inset 0 2px 8px rgba(0,255,0,.15); }
    50% { border-color: #00ffff; box-shadow: 0 0 20px rgba(0,255,255,.55), inset 0 2px 8px rgba(0,255,255,.20); }
  }

  .status{
    padding: 12px 16px 14px;
    display:flex;
    justify-content:space-between;
    gap:10px;
    flex-wrap:wrap;
    border-top: 1px solid rgba(255,255,255,.10);
    color: rgba(244,246,255,.72);
    font-size: 12px;
    position: relative;
  }

  .error{ color: var(--danger); font-weight: 800; }
  .ok{ color: var(--accent2); font-weight: 800; }

  .spinner{
    width: 14px; height: 14px;
    border-radius: 50%;
    border: 3px solid #ff00ff;
    border-top-color: #00ff00;
    display:inline-block;
    animation: spin 0.6s linear infinite;
    box-shadow: 0 0 10px rgba(255,0,255,.50);
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .toast{
    position: fixed;
    bottom: 18px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #ff00ff, #00ff00);
    border: 3px solid #ffff00;
    padding: 10px 12px;
    border-radius: 999px;
    color: #000;
    font-size: 13px;
    font-weight: 900;
    box-shadow: 0 0 30px rgba(255,0,255,.70), 0 18px 50px rgba(0,0,0,.50);
    opacity: 0;
    pointer-events:none;
    transition: opacity .18s ease;
  }
  .toast.show{ opacity: 1; }

  /* Chat Widget */
  .chat-widget{
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 9999;
  }

  .chat-button{
    width: 62px;
    height: 62px;
    border-radius: 50%;
    background: linear-gradient(135deg, #ff00ff, #00ff00);
    border: 4px solid #ffff00;
    box-shadow: 0 8px 0 #ff00ff, 0 18px 50px rgba(255,0,255,.60), 0 0 30px rgba(255,0,255,.50);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    transition: transform .15s ease, box-shadow .15s ease;
    animation: chatPulse 2s infinite;
  }
  .chat-button:hover{
    transform: scale(1.08) translateY(-3px);
    box-shadow: 0 10px 0 #ff00ff, 0 20px 60px rgba(255,0,255,.75), 0 0 40px rgba(255,0,255,.60);
  }
  .chat-button:active{
    transform: scale(0.95) translateY(0);
    box-shadow: 0 4px 0 #ff00ff, 0 10px 30px rgba(255,0,255,.50), 0 0 20px rgba(255,0,255,.40);
  }

  @keyframes chatPulse {
    0%, 100% { box-shadow: 0 8px 0 #ff00ff, 0 18px 50px rgba(255,0,255,.60), 0 0 30px rgba(255,0,255,.50); }
    50% { box-shadow: 0 8px 0 #ff00ff, 0 18px 50px rgba(255,0,255,.60), 0 0 45px rgba(0,255,255,.70); }
  }

  .chat-window{
    position: absolute;
    bottom: 80px;
    right: 0;
    width: 380px;
    height: 550px;
    background: linear-gradient(180deg, rgba(0,0,0,.90), rgba(20,0,30,.95));
    border: 4px solid #ff00ff;
    border-radius: 20px;
    box-shadow: 0 0 40px rgba(255,0,255,.70), 0 28px 80px rgba(0,0,0,.70), inset 0 0 30px rgba(0,255,255,.10);
    backdrop-filter: blur(20px);
    display: flex;
    flex-direction: column;
    opacity: 0;
    transform: translateY(20px) scale(0.95);
    pointer-events: none;
    transition: opacity .25s ease, transform .25s ease;
  }
  .chat-window.open{
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto;
  }

  .chat-header{
    padding: 18px 20px;
    background: linear-gradient(135deg, #ff00ff, #00ff00, #ffff00);
    border-bottom: 3px solid #000;
    border-radius: 16px 16px 0 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
  }

  .chat-header-info{
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .chat-avatar{
    width: 42px;
    height: 42px;
    border-radius: 50%;
    background: linear-gradient(135deg, #ff00ff, #00ffff);
    border: 3px solid #000;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    box-shadow: 0 0 20px rgba(255,0,255,.60), 0 8px 20px rgba(0,0,0,.30);
    animation: avatarSpin 4s linear infinite;
  }

  @keyframes avatarSpin {
    from { filter: hue-rotate(0deg); }
    to { filter: hue-rotate(360deg); }
  }

  .chat-header-text h3{
    margin: 0;
    font-size: 15px;
    font-weight: 900;
    color: #000;
    text-transform: uppercase;
  }
  .chat-header-text p{
    margin: 2px 0 0;
    font-size: 11px;
    color: #000;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .online-dot{
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: #00ff00;
    box-shadow: 0 0 0 4px rgba(0,255,0,.40), 0 0 10px #00ff00;
    animation: dotPulse 1s ease-in-out infinite;
  }

  .chat-close{
    width: 32px;
    height: 32px;
    border: 2px solid #000;
    background: #ff0000;
    border-radius: 8px;
    color: #fff;
    font-weight: 900;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: background .15s ease, transform .15s ease;
    box-shadow: 0 0 15px rgba(255,0,0,.50);
  }
  .chat-close:hover{
    background: #ff3333;
    transform: scale(1.1) rotate(90deg);
    box-shadow: 0 0 20px rgba(255,0,0,.70);
  }

  .chat-messages{
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .chat-message{
    display: flex;
    gap: 10px;
    animation: messageSlide .3s ease;
  }
  @keyframes messageSlide {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .chat-message.user{
    flex-direction: row-reverse;
  }

  .message-avatar{
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(124,92,255,.55), rgba(46,229,157,.45));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
  }

  .chat-message.user .message-avatar{
    background: linear-gradient(135deg, rgba(46,229,157,.55), rgba(124,92,255,.45));
  }

  .message-bubble{
    max-width: 70%;
    padding: 12px 14px;
    border-radius: 16px;
    background: linear-gradient(135deg, rgba(0,255,255,.30), rgba(0,255,0,.25));
    border: 2px solid #00ffff;
    color: #fff;
    font-size: 13.5px;
    line-height: 1.5;
    font-weight: 600;
    box-shadow: 0 0 15px rgba(0,255,255,.40), 0 4px 12px rgba(0,0,0,.25);
  }

  .chat-message.user .message-bubble{
    background: linear-gradient(135deg, rgba(255,0,255,.35), rgba(255,0,150,.30));
    border-color: #ff00ff;
    box-shadow: 0 0 15px rgba(255,0,255,.40), 0 4px 12px rgba(0,0,0,.25);
  }

  .message-time{
    font-size: 10px;
    color: rgba(244,246,255,.50);
    margin-top: 4px;
  }

  .chat-input-area{
    padding: 16px;
    border-top: 1px solid rgba(255,255,255,.10);
    background: rgba(6,8,18,.55);
    border-radius: 0 0 20px 20px;
  }

  .chat-input-wrapper{
    display: flex;
    gap: 10px;
    align-items: flex-end;
  }

  .chat-input{
    flex: 1;
    padding: 12px 14px;
    border-radius: 14px;
    border: 3px solid #00ff00;
    background: rgba(0,0,0,.85);
    color: #fff;
    font-size: 13px;
    font-weight: 600;
    outline: none;
    resize: none;
    max-height: 100px;
    font-family: inherit;
    line-height: 1.4;
    transition: border-color .15s ease, box-shadow .15s ease;
    box-shadow: 0 0 10px rgba(0,255,0,.40);
  }
  .chat-input:focus{
    border-color: #ffff00;
    box-shadow: 0 0 20px rgba(255,255,0,.60);
  }

  .chat-send{
    width: 44px;
    height: 44px;
    border: 3px solid #000;
    border-radius: 12px;
    background: linear-gradient(135deg, #ff00ff, #ff0080);
    color: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: transform .08s ease, filter .15s ease;
    box-shadow: 0 5px 0 #8800ff, 0 8px 20px rgba(255,0,255,.50);
    flex-shrink: 0;
  }
  .chat-send:hover{
    filter: brightness(1.2);
    transform: translateY(-2px);
    box-shadow: 0 7px 0 #8800ff, 0 12px 25px rgba(255,0,255,.60);
  }
  .chat-send:active{
    transform: translateY(2px);
    box-shadow: 0 3px 0 #8800ff, 0 5px 15px rgba(255,0,255,.40);
  }
  .chat-send:disabled{
    opacity: .5;
    cursor: not-allowed;
  }

  @media (max-width: 480px){
    .chat-window{
      width: calc(100vw - 24px);
      height: calc(100vh - 100px);
      bottom: 80px;
      right: 12px;
    }
    .chat-widget{
      right: 12px;
      bottom: 12px;
    }
  }

  .version{
    position: fixed;
    top: 12px;
    right: 12px;
    padding: 8px 14px;
    border-radius: 12px;
    background: linear-gradient(135deg, #00ffff, #00ff00);
    border: 3px solid #000;
    color: #000;
    font-size: 11px;
    font-weight: 900;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    box-shadow: 0 4px 0 #ff00ff, 0 8px 20px rgba(0,255,255,.50);
    z-index: 9998;
    animation: versionPulse 3s ease-in-out infinite;
  }

  @keyframes versionPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  @media (max-width: 480px){
    .version{
      top: 8px;
      right: 8px;
      padding: 6px 10px;
      font-size: 10px;
    }
  }
</style>
</head>

<body>
  <div class="version">v1.10</div>
  
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Traductor n8n + IA</h1>
          <div class="sub">Escribe el texto, elige el idioma destino y obt√©n la traducci√≥n al instante.</div>
        </div>
      </div>
      <div class="pill"><span class="dot"></span>Webhook activo (producci√≥n)</div>
    </div>

    <div class="card">
      <div class="toolbar">
        <div class="controls">
          <label for="target">Idioma destino</label>
          <select id="target" title="Idioma destino">
            <option value="es">Espa√±ol (es)</option>
            <option value="en">Ingl√©s (en)</option>
            <option value="fr">Franc√©s (fr)</option>
            <option value="pt">Portugu√©s (pt)</option>
            <option value="de">Alem√°n (de)</option>
            <option value="it">Italiano (it)</option>
          </select>

          <button class="btn" id="btn" type="button">
            <span id="btnIcon">ü™Ñ</span>
            <span id="btnText">Traducir</span>
          </button>

          <button class="btn secondary" id="btnClear" type="button">Limpiar</button>

          <!-- Bot√≥n WhatsApp -->
          <button class="btn whatsapp" id="shareWa" type="button" title="Compartir por WhatsApp">
            üì≤ WhatsApp
          </button>
        </div>

        <div class="small" id="charCount">0 caracteres</div>
      </div>

      <div class="grid">
        <div class="panel">
          <h2>
            Texto original
            <span class="small">Tip: puedes pegar p√°rrafos largos</span>
          </h2>
          <textarea id="text" placeholder="Ej: Hello world..."></textarea>
        </div>

        <div class="panel">
          <h2>
            Traducci√≥n
            <button class="btn secondary" id="copy" type="button">Copiar</button>
          </h2>
          <div id="out" class="out"></div>
        </div>
      </div>

      <div class="status">
        <div id="statusLeft"></div>
        <div id="statusRight">Fuente: Ollama (qwen3:8b)</div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">Copiado ‚úÖ</div>

  <!-- Chat Widget -->
  <div class="chat-widget">
    <button class="chat-button" id="chatToggle" type="button" aria-label="Abrir chat">
      üí¨
    </button>

    <div class="chat-window" id="chatWindow">
      <div class="chat-header">
        <div class="chat-header-info">
          <div class="chat-avatar">ü§ñ</div>
          <div class="chat-header-text">
            <h3>Soporte IA</h3>
            <p><span class="online-dot"></span>En l√≠nea</p>
          </div>
        </div>
        <button class="chat-close" id="chatClose" type="button" aria-label="Cerrar chat">‚úï</button>
      </div>

      <div class="chat-messages" id="chatMessages">
        <!-- Los mensajes se agregan din√°micamente -->
      </div>

      <div class="chat-input-area">
        <div class="chat-input-wrapper">
          <textarea 
            class="chat-input" 
            id="chatInput" 
            placeholder="Escribe tu mensaje..."
            rows="1"></textarea>
          <button class="chat-send" id="chatSend" type="button" aria-label="Enviar mensaje">üì§</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Usando proxy CORS para bypasear restricciones
    const OLLAMA_URL = "https://unbroke-unexplodable-lilly.ngrok-free.dev";
    const USE_CORS_PROXY = false; // Cambiar a false si el servidor ya tiene CORS habilitado
    const CORS_PROXY = "https://thingproxy.freeboard.io/fetch/";

    function getApiUrl(endpoint) {
      const fullUrl = `${OLLAMA_URL}${endpoint}`;
      return USE_CORS_PROXY ? `${CORS_PROXY}${fullUrl}` : fullUrl;
    }

    const $ = (id) => document.getElementById(id);
    const btn = $("btn");
    const btnText = $("btnText");
    const btnIcon = $("btnIcon");
    const out = $("out");
    const statusLeft = $("statusLeft");
    const charCount = $("charCount");
    const toast = $("toast");

    function toastShow(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(()=> toast.classList.remove("show"), 1200);
    }

    function setLoading(isLoading){
      btn.disabled = isLoading;
      btnIcon.innerHTML = isLoading ? "<span class='spinner'></span>" : "ü™Ñ";
      btnText.textContent = isLoading ? "Traduciendo..." : "Traducir";
    }

    $("text").addEventListener("input", () => {
      charCount.textContent = `${$("text").value.length} caracteres`;
    });

    $("btnClear").addEventListener("click", () => {
      $("text").value = "";
      out.textContent = "";
      statusLeft.textContent = "Listo.";
      charCount.textContent = "0 caracteres";
    });

    $("copy").addEventListener("click", async () => {
      const txt = out.textContent.trim();
      if (!txt) return toastShow("Nada para copiar");
      try{
        await navigator.clipboard.writeText(txt);
        toastShow("Copiado ‚úÖ");
      }catch{
        toastShow("No se pudo copiar");
      }
    });

    // ‚úÖ Compartir por WhatsApp (SOLO EL LINK)
    $("shareWa").addEventListener("click", () => {
      const url = window.location.href;  // esto ser√° tu link de GitHub Pages
      const waUrl = "https://wa.me/?text=" + encodeURIComponent(url);
      window.open(waUrl, "_blank");
    });

    btn.addEventListener("click", async () => {
      const text = $("text").value.trim();
      const target = $("target").value;

      if (!text){
        out.innerHTML = "<span style='color: var(--danger); font-weight:700;'>Escribe un texto para traducir.</span>";
        statusLeft.innerHTML = "<span class='error'>Falta texto.</span>";
        return;
      }

      setLoading(true);
      statusLeft.textContent = "Traduciendo con IA...";

      try{
        // Mapa de c√≥digos de idioma a nombres completos
        const languages = {
          'es': 'espa√±ol',
          'en': 'ingl√©s',
          'fr': 'franc√©s',
          'pt': 'portugu√©s',
          'de': 'alem√°n',
          'it': 'italiano'
        };

        const targetLang = languages[target] || target;

        // Timeout personalizado para la petici√≥n
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 60000); // 60 segundos

        // Llamada a Ollama para traducci√≥n
        const res = await fetch(getApiUrl("/api/chat"), {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "qwen3:8b",
            messages: [
              {
                role: "system",
                content: `Eres un traductor profesional. Tu √∫nica tarea es traducir el texto que te proporcionen al idioma ${targetLang}. Responde √öNICAMENTE con la traducci√≥n, sin explicaciones, sin comentarios adicionales, solo el texto traducido.`
              },
              {
                role: "user",
                content: text
              }
            ],
            stream: false
          }),
          signal: controller.signal
        });

        clearTimeout(timeoutId);

        if (!res.ok){
          const errorText = await res.text().catch(() => "");
          console.error("Error del servidor:", res.status, res.statusText, errorText);
          out.innerHTML = "<span class='error'>Error en el servidor (" + res.status + "): " + (errorText || res.statusText || "Error desconocido") + "</span>";
          statusLeft.innerHTML = "<span class='error'>Error " + res.status + "</span>";
        } else {
          const data = await res.json();
          const translation = data.message?.content || "(sin traducci√≥n)";
          out.textContent = translation;
          statusLeft.innerHTML = "<span class='ok'>‚úì</span> Traducido a <b>"+ targetLang +"</b>";
        }
      }catch(e){
        console.error("Error de traducci√≥n completo:", e);
        if (e.name === 'AbortError') {
          out.innerHTML = "<span class='error'>‚è±Ô∏è El servidor tard√≥ demasiado en responder. Intenta con un texto m√°s corto.</span>";
          statusLeft.innerHTML = "<span class='error'>Timeout.</span>";
        } else {
          out.innerHTML = "<span class='error'>‚ùå Error de conexi√≥n: " + e.message + "<br>Verifica la consola del navegador (F12) para m√°s detalles.</span>";
          statusLeft.innerHTML = "<span class='error'>Sin conexi√≥n.</span>";
        }
      }finally{
        setLoading(false);
      }
    });

    // Chat Widget functionality
    const chatToggle = $("chatToggle");
    const chatWindow = $("chatWindow");
    const chatClose = $("chatClose");
    const chatMessages = $("chatMessages");
    const chatInput = $("chatInput");
    const chatSend = $("chatSend");

    // Funci√≥n para obtener hora actual
    function getCurrentTime(){
      const now = new Date();
      return now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
    }

    // Funci√≥n para agregar mensaje al chat
    function addMessage(text, isUser = false){
      const messageDiv = document.createElement("div");
      messageDiv.className = "chat-message" + (isUser ? " user" : "");
      
      const avatar = document.createElement("div");
      avatar.className = "message-avatar";
      avatar.textContent = isUser ? "üë§" : "ü§ñ";
      
      const contentDiv = document.createElement("div");
      
      const bubble = document.createElement("div");
      bubble.className = "message-bubble";
      bubble.textContent = text;
      
      const time = document.createElement("div");
      time.className = "message-time";
      time.textContent = getCurrentTime();
      
      contentDiv.appendChild(bubble);
      contentDiv.appendChild(time);
      messageDiv.appendChild(avatar);
      messageDiv.appendChild(contentDiv);
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Mensaje de bienvenida al abrir el chat por primera vez
    let chatOpened = false;
    
    function toggleChat(){
      chatWindow.classList.toggle("open");
      if(chatWindow.classList.contains("open")){
        chatInput.focus();
        
        // Mostrar mensaje de bienvenida solo la primera vez
        if(!chatOpened){
          chatOpened = true;
          setTimeout(() => {
            addMessage("¬°Hola! üëã Bienvenido al Traductor n8n + IA");
          }, 300);
          setTimeout(() => {
            addMessage("Soy tu asistente virtual. ¬øEn qu√© puedo ayudarte hoy?");
          }, 900);
          setTimeout(() => {
            addMessage("Puedo responder preguntas sobre c√≥mo usar el traductor, los idiomas disponibles, o cualquier duda que tengas. üòä");
          }, 1500);
        }
      }
    }

    chatToggle.addEventListener("click", toggleChat);
    chatClose.addEventListener("click", toggleChat);

    // Auto-resize textarea
    chatInput.addEventListener("input", function(){
      this.style.height = "auto";
      this.style.height = Math.min(this.scrollHeight, 100) + "px";
    });

    // Enviar mensaje con Enter (Shift+Enter para nueva l√≠nea)
    chatInput.addEventListener("keydown", function(e){
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        chatSend.click();
      }
    });

    // Funci√≥n para enviar mensaje a Ollama
    chatSend.addEventListener("click", async function(){
      const message = chatInput.value.trim();
      if(!message) return;

      // Guardar el mensaje antes de limpiar
      const userMessage = message;
      
      // Limpiar input primero
      chatInput.value = "";
      chatInput.style.height = "auto";

      // Mostrar mensaje del usuario
      addMessage(userMessage, true);

      // Deshabilitar bot√≥n mientras se procesa
      chatSend.disabled = true;

      // Mostrar indicador de escritura
      const typingDiv = document.createElement("div");
      typingDiv.className = "chat-message";
      typingDiv.id = "typing-indicator";
      typingDiv.innerHTML = `
        <div class="message-avatar">ü§ñ</div>
        <div>
          <div class="message-bubble">
            <span class="spinner"></span> Escribiendo...
          </div>
        </div>
      `;
      chatMessages.appendChild(typingDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      try {
        // Llamada a Ollama
        const response = await fetch(getApiUrl("/api/chat"), {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "qwen3:8b",
            messages: [
              {
                role: "system",
                content: "Eres un asistente √∫til del Traductor n8n + IA. Ayudas a los usuarios con preguntas sobre c√≥mo usar el traductor, los idiomas disponibles, y cualquier duda relacionada con la aplicaci√≥n. Responde de manera amigable y concisa."
              },
              {
                role: "user",
                content: message
              }
            ],
            stream: false
          })
        });

        // Remover indicador de escritura
        const typing = document.getElementById("typing-indicator");
        if(typing) typing.remove();

        if(response.ok){
          const data = await response.json();
          const aiResponse = data.message?.content || "Lo siento, no pude generar una respuesta.";
          addMessage(aiResponse);
        } else {
          addMessage("Lo siento, hubo un error al conectar con el servidor. Por favor intenta nuevamente.");
        }
      } catch(error) {
        console.error("Error:", error);
        const typing = document.getElementById("typing-indicator");
        if(typing) typing.remove();
        addMessage("No pude conectarme al servidor. Verifica que el servicio de Ollama est√© activo.");
      } finally {
        chatSend.disabled = false;
      }
    });
  </script>
</body>
</html>

